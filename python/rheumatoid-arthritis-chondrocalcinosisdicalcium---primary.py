# Rebecca M Joseph, Mohammad Movahedi, William G Dixon, Deborah PM Symmons, 2023.

import sys, csv, re

codes = [{"code":"B000z00","system":"readv2"},{"code":"B001z00","system":"readv2"},{"code":"B002z00","system":"readv2"},{"code":"B003z00","system":"readv2"},{"code":"B00zz00","system":"readv2"},{"code":"B010z00","system":"readv2"},{"code":"B011z00","system":"readv2"},{"code":"B013z00","system":"readv2"},{"code":"B01z.00","system":"readv2"},{"code":"B03z.00","system":"readv2"},{"code":"B04z.00","system":"readv2"},{"code":"B055z00","system":"readv2"},{"code":"B05z.00","system":"readv2"},{"code":"B060z00","system":"readv2"},{"code":"B062z00","system":"readv2"},{"code":"B064z00","system":"readv2"},{"code":"B06yz00","system":"readv2"},{"code":"B06z.00","system":"readv2"},{"code":"B071z00","system":"readv2"},{"code":"B072z00","system":"readv2"},{"code":"B073z00","system":"readv2"},{"code":"B07z.00","system":"readv2"},{"code":"B10z.00","system":"readv2"},{"code":"B11yz00","system":"readv2"},{"code":"B11z.00","system":"readv2"},{"code":"B13z.00","system":"readv2"},{"code":"B150z00","system":"readv2"},{"code":"B180z00","system":"readv2"},{"code":"B18yz00","system":"readv2"},{"code":"B18z.00","system":"readv2"},{"code":"B1z1z00","system":"readv2"},{"code":"B1zz.00","system":"readv2"},{"code":"B200z00","system":"readv2"},{"code":"B20z.00","system":"readv2"},{"code":"B215.00","system":"readv2"},{"code":"B21z.00","system":"readv2"},{"code":"B220z00","system":"readv2"},{"code":"B221z00","system":"readv2"},{"code":"B222z00","system":"readv2"},{"code":"B223z00","system":"readv2"},{"code":"B224z00","system":"readv2"},{"code":"B22z.00","system":"readv2"},{"code":"B23z.00","system":"readv2"},{"code":"B241z00","system":"readv2"},{"code":"B2zz.00","system":"readv2"},{"code":"B303z00","system":"readv2"},{"code":"B304z00","system":"readv2"},{"code":"B305z00","system":"readv2"},{"code":"B307z00","system":"readv2"},{"code":"B30z.00","system":"readv2"},{"code":"B310z00","system":"readv2"},{"code":"B312z00","system":"readv2"},{"code":"B313z00","system":"readv2"},{"code":"B314z00","system":"readv2"},{"code":"B315z00","system":"readv2"},{"code":"B31z.00","system":"readv2"},{"code":"B323z00","system":"readv2"},{"code":"B324z00","system":"readv2"},{"code":"B326z00","system":"readv2"},{"code":"B327z00","system":"readv2"},{"code":"B32z.00","system":"readv2"},{"code":"B340z00","system":"readv2"},{"code":"B34yz00","system":"readv2"},{"code":"B34z.00","system":"readv2"},{"code":"B35zz00","system":"readv2"},{"code":"B3z..00","system":"readv2"},{"code":"B430z00","system":"readv2"},{"code":"B431z00","system":"readv2"},{"code":"B43z.00","system":"readv2"},{"code":"B44z.00","system":"readv2"},{"code":"B450z00","system":"readv2"},{"code":"B45z.00","system":"readv2"},{"code":"B48yz00","system":"readv2"},{"code":"B48z.00","system":"readv2"},{"code":"B49z.00","system":"readv2"},{"code":"B4A1z00","system":"readv2"},{"code":"B4Az.00","system":"readv2"},{"code":"B4z..00","system":"readv2"},{"code":"B501z00","system":"readv2"},{"code":"B512z00","system":"readv2"},{"code":"B51yz00","system":"readv2"},{"code":"B51z.00","system":"readv2"},{"code":"B521z00","system":"readv2"},{"code":"B523z00","system":"readv2"},{"code":"B540z00","system":"readv2"},{"code":"B550000","system":"readv2"},{"code":"B550100","system":"readv2"},{"code":"B550200","system":"readv2"},{"code":"B550300","system":"readv2"},{"code":"B550400","system":"readv2"},{"code":"B550500","system":"readv2"},{"code":"B550z00","system":"readv2"},{"code":"B551z00","system":"readv2"},{"code":"B553000","system":"readv2"},{"code":"B553z00","system":"readv2"},{"code":"B554.00","system":"readv2"},{"code":"B555.00","system":"readv2"},{"code":"B55y000","system":"readv2"},{"code":"B55y100","system":"readv2"},{"code":"B55y200","system":"readv2"},{"code":"B55yz00","system":"readv2"},{"code":"B560z00","system":"readv2"},{"code":"B564z00","system":"readv2"},{"code":"B565z00","system":"readv2"},{"code":"B56z.00","system":"readv2"},{"code":"B576z00","system":"readv2"},{"code":"B581z00","system":"readv2"},{"code":"B582z00","system":"readv2"},{"code":"B583z00","system":"readv2"},{"code":"B58yz00","system":"readv2"},{"code":"B58z.00","system":"readv2"},{"code":"B590.00","system":"readv2"},{"code":"B591.00","system":"readv2"},{"code":"B59z.00","system":"readv2"},{"code":"B5z..00","system":"readv2"},{"code":"B600z00","system":"readv2"},{"code":"B601z00","system":"readv2"},{"code":"B602z00","system":"readv2"},{"code":"B60z.00","system":"readv2"},{"code":"B613z00","system":"readv2"},{"code":"B614z00","system":"readv2"},{"code":"B615z00","system":"readv2"},{"code":"B616z00","system":"readv2"},{"code":"B61z.00","system":"readv2"},{"code":"B61z000","system":"readv2"},{"code":"B61z100","system":"readv2"},{"code":"B61z500","system":"readv2"},{"code":"B61z700","system":"readv2"},{"code":"B61z800","system":"readv2"},{"code":"B61zz00","system":"readv2"},{"code":"B620z00","system":"readv2"},{"code":"B621z00","system":"readv2"},{"code":"B623z00","system":"readv2"},{"code":"B624z00","system":"readv2"},{"code":"B625z00","system":"readv2"},{"code":"B627C11","system":"readv2"},{"code":"B62y.00","system":"readv2"},{"code":"B62y000","system":"readv2"},{"code":"B62y100","system":"readv2"},{"code":"B62y500","system":"readv2"},{"code":"B62y600","system":"readv2"},{"code":"B62y700","system":"readv2"},{"code":"B62y800","system":"readv2"},{"code":"B62yz00","system":"readv2"},{"code":"B62z.00","system":"readv2"},{"code":"B62zz00","system":"readv2"},{"code":"B63z.00","system":"readv2"},{"code":"B64yz00","system":"readv2"},{"code":"B64z.00","system":"readv2"},{"code":"B651z00","system":"readv2"},{"code":"B65yz00","system":"readv2"},{"code":"B65z.00","system":"readv2"},{"code":"B66z.00","system":"readv2"},{"code":"B67yz00","system":"readv2"},{"code":"B67z.00","system":"readv2"},{"code":"B680.00","system":"readv2"},{"code":"B681.00","system":"readv2"},{"code":"B682.00","system":"readv2"},{"code":"B68z.00","system":"readv2"},{"code":"C34z.00","system":"readv2"},{"code":"J400400","system":"readv2"},{"code":"J400z00","system":"readv2"},{"code":"J401z00","system":"readv2"},{"code":"J40z.11","system":"readv2"},{"code":"M160z00","system":"readv2"},{"code":"M161z00","system":"readv2"},{"code":"M16z.00","system":"readv2"},{"code":"N011z00","system":"readv2"},{"code":"N015z00","system":"readv2"},{"code":"N016z00","system":"readv2"},{"code":"N02..11","system":"readv2"},{"code":"N022.00","system":"readv2"},{"code":"N022000","system":"readv2"},{"code":"N022500","system":"readv2"},{"code":"N022600","system":"readv2"},{"code":"N022y00","system":"readv2"},{"code":"N022z00","system":"readv2"},{"code":"N023z00","system":"readv2"},{"code":"N02yz00","system":"readv2"},{"code":"N02z.00","system":"readv2"},{"code":"N02z300","system":"readv2"},{"code":"N02z400","system":"readv2"},{"code":"N02z600","system":"readv2"},{"code":"N02z700","system":"readv2"},{"code":"N02zD00","system":"readv2"},{"code":"N02zF00","system":"readv2"},{"code":"N02zK00","system":"readv2"},{"code":"N02zL00","system":"readv2"},{"code":"N02zz00","system":"readv2"},{"code":"N10yz00","system":"readv2"}];
REQUIRED_CODES = 1;
with open(sys.argv[1], 'r') as file_in, open('rheumatoid-arthritis-potential-cases.csv', 'w', newline='') as file_out:
    csv_reader = csv.DictReader(file_in)
    csv_writer = csv.DictWriter(file_out, csv_reader.fieldnames + ["rheumatoid-arthritis-chondrocalcinosisdicalcium---primary-identified"])
    csv_writer.writeheader();
    codes_identified = 0;
    for row in csv_reader:
        newRow = row.copy();
        for cell in row:
            # Iterate cell lists (e.g. codes)
            for item in re.findall(r'\(([^,]*)\,', row[cell]):
                if(item in list(map(lambda code: code['code'], codes))): codes_identified+=1;
                if(codes_identified>=REQUIRED_CODES):
                    newRow["rheumatoid-arthritis-chondrocalcinosisdicalcium---primary-identified"] = "CASE";
                    break;
            if(codes_identified>=REQUIRED_CODES): break;
        if(codes_identified<REQUIRED_CODES):
            newRow["rheumatoid-arthritis-chondrocalcinosisdicalcium---primary-identified"] = "UNK";
        codes_identified=0;
        csv_writer.writerow(newRow)
